<dom-module id="game-judge">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>
    
    <slot on-tick="_countTick" on-pressed-keys="_registerKeys" on-joievent="_holdEvents"></slot>

  </template>

  <script>
    class GameJudge extends Polymer.Element {
      static get is() {
        return "game-judge";
      }
      static get config() {
        return {
          properties: {
            ticksPerTurn: {
              type: Number,
              value: 20
            },
            heldEvents: {
              type: Array,
              value: function() {
                return []
              }
            }
          }
        }
      }

      _holdEvents(e) {
        debugger;
        if (!e.detail.duration) {
          e.detail.duration = 1;
        };
        if (e.detail.duration != 0) {
          // e.stopPropagation();
          e.detail.ticksLeft = e.detail.duration*this.ticksPerTurn;
          this.heldEvents.push(e);
        }
      }

      holdEvents(e) {
        if (!e.detail.duration) {
          e.detail.duration = 1;
        };
        if (e.detail.duration != 0) {
          e.stopPropagation();
          e.detail.ticksLeft = e.detail.duration*this.ticksPerTurn;
          this.heldEvents.push(e);
        }
      }

      _countTick(e) {
        for(let i = 0; i < this.heldEvents.length; i++) {
          let event = this.heldEvents[i];
          event.detail.ticksLeft--;
          if (event.detail.ticksLeft <= 0) {
            this.dispatchEvent(new CustomEvent(event.type, event));
          }
        }
      }

      _registerKeys(e) {
        debugger;
      }
    }
    customElements.define(GameJudge.is, GameJudge);
  </script>
</dom-module>