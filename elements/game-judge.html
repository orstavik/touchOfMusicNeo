<dom-module id="game-judge">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>

    <slot on-tick="_countTick" on-pressed-keys="_registerKeys" on-joievent="_holdEvents"></slot>

  </template>

  <script>
    class GameJudge extends Polymer.Element {
      static get is() {
        return "game-judge";
      }

      static get config() {
        return {
          properties: {
            ticksPerTurn: {
              type: Number,
              value: 20
            },
            heldEvents: {
              type: Array,
              value: function () {
                return [];
              }
            }
          }
        }
      }

      _holdEvents(e) {
        if (e.detail.duration) { //duration exists and is not 0
          e.stopPropagation();
          e.preventDefault();
          e.detail.ticksLeft = e.detail.duration * this.ticksPerTurn;
          this.heldEvents.push(e);
        }
      }

      _countTick(e) {
        for (let hostage of this.heldEvents)
          hostage.detail.ticksLeft--;
        let doDonaldTrumpOnTheseGuys = this.heldEvents.filter(function (toDonald) {
          return toDonald.detail.ticksLeft <= 0;
        });
        this.heldEvents = this.heldEvents.filter(function (el) {
          return doDonaldTrumpOnTheseGuys.indexOf(el) < 0;
        });
        for (let donald of doDonaldTrumpOnTheseGuys)
          this.dispatchEvent(new CustomEvent(donald.type, donald));
      }

      _registerKeys(e) {
//        debugger;
      }
    }
    customElements.define(GameJudge.is, GameJudge);
  </script>
</dom-module>