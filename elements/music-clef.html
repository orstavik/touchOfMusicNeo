<dom-module id="music-clef">
  <template>
    <style>
      :host {
        display: block;
      }

      .triangle {
        border: 2px solid white;
        font-size: 10px;
        width: 50px;
        transform-origin: 50% -100%;
        position: absolute;
        top: 100px;
        left: 100px;
      }

      .inner {
        border: 2px solid white;
        font-size: 10px;
        width: 50px;
        transform: rotate(90deg);
      }

      #clef {
        transform: rotate(180deg);
        position: relative;
        width: 200px;
        height: 200px;
      }
    </style>
    <div id="clef">
      <template is="dom-repeat" items="[[twelveNotes]]">
        <div class="triangle" style$="[[_getStyleOut(item, index)]]">
          <div class="inner" style$="[[_getStyleIn(item, index)]]">
            [[item]]: [[_getNotePositionInWheelOf5ByName(item)]]
          </div>
        </div>
      </template>
    </div>
  </template>
  <script>

    class MusicClef extends Polymer.Element {
      static get is() {
        return "music-clef";
      }

      static get config() {
        return {
          properties: {
            mode: {
              type: String,
              notify: true,
              observer: "setup"
            },
            key: {
              type: String,
              notify: true,
              observer: "setup"
            }
          }
        }
      }

      setup() {
        console.log("key: " + this.key);
        console.log("mode: " + this.mode);
        let scale = this.querySelector("music-scale");
        this.twelveNotes = MusicScale.twelveNotes;//["C", "G", "D", "A", "E", "B", "F#","C#", "G#", "D#", "A#", "F"];
        this.inScaleNumbers = scale.getAllSevenNotesInScale();//["C", "G", "D", "A", "E", "B", "F#","C#", "G#", "D#", "A#", "F"];
//        this.modeName = this.mode; ??
//        this.keyName = this.key; ??
      }

      _getNotePositionInWheelOf5ByName(noteName) {
        let scale = this.querySelector("music-scale");
        return MusicScale.getNotePositionInWheelOf5ByName(noteName);
      }

      _getStyleOut(noteName, index) {
        let scale = this.querySelector("music-scale");
        let chord = this.querySelector("music-chord");
        let position12 = MusicScale.getNotePositionNormal(noteName);
        let position7 = scale.getSevenNoteNumber(noteName);
        let deg12 = position12 * 30;
        let modularScale = scale._modularScale;
        let size = 0; //by default all keys are invisibly small
        if (modularScale.indexOf(index) >= 0) {
          size = 1;
          let chordType = chord.getChordType(position7);
          if (chordType == "maj")
            size = 2;
          else if (chordType == "dim")
            size = 0.5;
        }
        return " transform: rotate(" + deg12 + "deg) scale(" + size + ");";
      }

      _getStyleIn(noteName, index) {
        let scale = this.querySelector("music-scale");
        let position5 = MusicScale.getNotePositionInWheelOf5ByName(noteName); //= this._getNotePositionInWheelOf5ByName(noteName);
        return "background-color: hsl(" + position5 * 30 + ", 100%, 50%);";
      }

    }
    customElements.define(MusicClef.is, MusicClef);
  </script>
</dom-module>