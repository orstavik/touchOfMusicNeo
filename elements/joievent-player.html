<dom-module id="joievent-player">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>

    <slot on-joievent="_fireNextEvent"></slot>

  </template>

  <script>
    class JoieventPlayer extends Polymer.Element {
      static get is() {
        return "joievent-player";
      }

      static get config() {
        return {
          properties: {
            input: {
              type: String,
              observer: "_inputChange"
            },
            // eventName: {
            //   type: String
            // },
            _joi: {
              type: Array,
              value: function () {
                return []
              }
            },
            eventIDS: {
              type: Number,
              value: 0
            }
          }
        }
      }

      _inputChange() {
        this._joi = JOI.parse(this.input);
        setTimeout(function () {
          this._fireNextEvent();
        }.bind(this), 0);
      }

      _fireNextEvent(e) {
        let canons = this.querySelectorAll("joievent-canon");
        let nextEvents = this._joi.pop();
        if (!nextEvents)
          return;
        for (let event of nextEvents) {
          event.id = this.eventIDS += 2;
          console.log(event);
          canons.forEach(function (canon) {
            canon.fireEvent("joievent", event);
          }.bind(this));
        }
      }
    }
    customElements.define(JoieventPlayer.is, JoieventPlayer);
  </script>
</dom-module>