<dom-module id="key-flower">
  <template>
    <style>
      :host {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 20vh;
        height: 20vh;
        margin: 0 -10vh -10vh 0;
        position: absolute;
        bottom: 25vh;
        right: 25vh;
      }
      .leaf {
        display: inline-block;
        box-sizing: border-box;
        width: 80%;
        height: 80%;
        bottom: 50%;
        position: absolute;
        transform-origin: bottom;
        transition-duration: 0.5s;
      }
      .innerLeaf{
        display: inline-block;
        width: 100%;
        height: 100%;
        position: absolute;
        border-top-left-radius: 50%;
        border-bottom-left-radius: 50%;
        border-top-right-radius: 50%;
        transform: rotate(45deg);
        transition-duration: 0.5s;
        box-shadow: 0 0 3px 0px black;
        font-size: 12px;
        color: black;
      }
      #flowerCenter {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 10vh;
        height: 10vh;
        border-radius: 50%;
        background: black;
        box-shadow: 0 0 3px 0 black;
        color: wheat;
        line-height: normal;
        text-align: center;
        font-size: 2vh;
        z-index: 1;
      }
      .note {
        position: absolute;
        left: 50%;
        top: 0%;
        margin-top: 1vh;
        font-size: 3.5vh;
        font-weight: bold;
        transform: translateX(-50%) scaleY(0.75);
      }
    </style>

    <div id="flowerCenter">
      [[scale.key]]
      [[scale.mode]]
    </div>
    <template is="dom-repeat" items="[[_makeArray(scale)]]">
      <div class="leaf" style$="transform: rotate([[_setRotate(item.number)]]deg) scale([[_setScale(item.type)]]) translateY(-7vh);">
        <div class="innerLeaf" style$="background: [[_setColor(item.number)]]"></div>
        <span class="note">
          [[item.name]]
        </span>
      </div>
    </template>

  </template>

  <script>
    class KeyFlower extends Polymer.Element {
      static get is() {
        return "key-flower";
      }

      static get config() {
        return {
          properties: {
            palette: Object,
            scale: Object
          }
        }
      }

      _makeArray(scale) {
        if (scale) {
          var arr = [];
          for (let i = 0; i < 7; i++) {
            arr.push({
              number: scale.getTonePosition(i),
              name: scale.getToneName(i),
              type: scale.getChordType(i)
            })
            arr.sort(function(a,b){
              return a.number - b.number;
            });
          }
        }
        return arr;
      }
      
      _setScale(type) {
        switch (type) {
          case "maj":
            return "0.75, 1";
          case "min":
            return "0.6375, 0.85";
          case "dim":
            return "0.525, 0.7";
        }
      }

      _setTranslate(number){
        return "translate(0, calc(100%)";
      }

      _setColor(number){
        return this.palette.getColor(number);
      }

      _setRotate(number){
        return 30*number;
      }
    }
    customElements.define(KeyFlower.is, KeyFlower);
  </script>
</dom-module>