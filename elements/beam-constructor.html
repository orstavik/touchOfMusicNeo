<link rel="import" href="light-beam.html">

<dom-module id="beam-constructor">
  <template>
    <style>
      .beam {
        display: inline-block;
        position: absolute;
        border-radius: 70px;
        transform-origin: left;
        overflow: hidden;
        z-index: 10;
      }
      
      .innerBeam {
        height: 100%;
        width: 50%;
        border-radius: 70px;
        transform-origin: left;
        transition-timing-function: linear;
        animation-fill-mode: forwards;
        animation: Transfer 1s linear;
        z-index: 1;
      }

      @keyframes Transfer {
        0% {
          transform: translateX(-100%)
        }
        100% {
          transform: translateX(200%)
        }
      }
    </style>

    <slot></slot>

  </template>

  <script>
    class BeamConstructor extends Polymer.Element {
      static get is() {
        return "beam-constructor";
      }
      static get config() {
        return {
          properties: {
            index: {
              type: Number,
              value: 0
            },
            colorMap: {
              type: Object,
              value: function() {
                return {
                  RightIndex: "205,212,4",
                  RightLongfinger: "49,193,191",
                  RightRingfinger: "68,169,227",
                  RightPinky: "36,67,208",
                  LeftIndex: "252,223,84",
                  LeftLongfinger: "254,157,5",
                  LeftRingfinger: "231,83,173",
                  LeftPinky: "183,11,116"
                }
              }
            }
          }
        }
      }

      constructor() {
        super();
      }

			prepareBeam(pressed) {
        for (var i = 0; i < pressed.length; i++) {
          let key = pressed[i];
          let keyNode = this.querySelector("[code="+ key+"] key-pyramid");
					if (keyNode) {
            let origin = keyNode.getRect();
						let target = this.querySelector("#monster").getRect();
            let color = this.colorMap[keyNode.classList[0]];

						if (origin && target) {
              var lightBeam = new LightBeam("beam"+(this.index++), origin, target, color);
              this.shadowRoot.appendChild(lightBeam);
            }
					}
				}
			}
    }
    customElements.define(BeamConstructor.is, BeamConstructor);
  </script>
</dom-module>