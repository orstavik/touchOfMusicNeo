<link rel="import" href="light-beam.html">

<dom-module id="beam-constructor">
  <template>
    <style>
      .beam {
        display: inline-block;
        position: absolute;
        border-radius: 70px;
        transform-origin: left;
        overflow: hidden;
        z-index: 10;
      }
      
      .innerBeam {
        height: 100%;
        width: 50%;
        border-radius: 70px;
        transform-origin: left;
        transition-timing-function: linear;
        animation-fill-mode: forwards;
        animation: Transfer 1s linear;
        z-index: 1;
      }

      @keyframes Transfer {
        0% {
          transform: translateX(-100%)
        }
        100% {
          transform: translateX(200%)
        }
      }
    </style>

  </template>

  <script>
    class BeamConstructor extends Polymer.Element {
      static get is() {
        return "beam-constructor";
      }
      static get config() {
        return {
          properties: {
            index: {
              type: Number,
              value: 0
            },
            beams: {
              type: Array,
              value: function() {
                return []
              }
            },

          }
        }
      }

      constructor() {
        super();
        this.addEventListener("remove-me", this._removeBeam.bind(this));
      }

      constructBeam(origin,target,finger) {
        var colorMap = {
          RightIndex: "205,212,4",
          RightLongfinger: "49,193,191",
          RightRingfinger: "68,169,227",
          RightPinky: "36,67,208",
          LeftIndex: "252,223,84",
          LeftLongfinger: "254,157,5",
          LeftRingfinger: "231,83,173",
          LeftPinky: "183,11,116"
        };
        var color = colorMap[finger];

        var beam = {
          longitude: Math.sqrt(Math.pow(((origin.top+origin.height/2)-(target.top+target.height/2)), 2) + Math.pow(((origin.left+origin.width/2)-(target.left+target.width/2)), 2)),
          width: 2,
          origin: {
            x: origin.left+origin.width/2,
            y: origin.top+origin.height/2
          },
          angle: Math.atan2((origin.top+origin.height/2)-(target.top+target.height/2), (origin.left+origin.width/2)-(target.left+target.width/2))*180/Math.PI+180
        }

        var LightBeam = customElements.get("light-beam");
        var lightBeam = new LightBeam();
        lightBeam.id = "beam"+(this.index++);
        lightBeam.data = beam;
        lightBeam.color = color;
        this.shadowRoot.appendChild(lightBeam);
      }
    }
    customElements.define(BeamConstructor.is, BeamConstructor);
  </script>
</dom-module>