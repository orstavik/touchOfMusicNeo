<dom-module id="music-scale">
    <template>
        <style>
            :host {
              display: none;
            }
        </style>
    </template>
    <script>

      class MusicScale extends Polymer.Element {
        static get is() {
          return "music-scale";
        }

        constructor(){
          super();
          this.staticNotes = ["C", "Db/C#", "D", "Eb/D#", "E", "F", "Gb/F#", "G", "Ab/G#", "A", "Bb/A#", "B"];
          this.staticScales = [
            [[0, 1, 3, 5, 6, 8, 10], "locrian"],
            [[0, 2, 3, 5, 7, 8, 10], "minor"], // aeolian VI
            [[0, 2, 4, 5, 7, 9, 10], "mixolydian"],
            [[0, 2, 4, 6, 7, 9, 11], "lydian"],
            [[0, 1, 3, 5, 7, 8, 10], "phrygian"],
            [[0, 2, 3, 5, 7, 9, 10], "dorian"],
            [[0, 2, 4, 5, 7, 9, 11], "major"] //ionian I
          ];
          this.modePosition = 6;        //start with major, first to be flattened is B, first to sharpen is F
          this.modularScale = this.staticScales[this.modePosition][0].slice();
        }

        getTwelveNotesName(number){
          return this.staticNotes[number];
        }

        getSevenNoteNumber(noteName) {
          return this.modularScale.indexOf(this.getNotePositionNormal(noteName));
        }

        getRoot(){
          return this.modularScale ? this.modularScale[0] : 0;
        }

        getSevenNoteTone(zeeroToSix){
          return this.modularScale[zeeroToSix];
        }

        getNotePositionInWheelOf5ByName(noteName){                      //used to calculate note color: hsl(notePosition/12*360, 100, 67);
          let wheelOfFive = ["C", "G", "D", "A", "E", "B", "Gb/F#","Db/C#", "Ab/G#", "Eb/D#", "Bb/A#", "F"];
          return wheelOfFive.indexOf(noteName);
        }

        getNotePositionNormal(noteName){
          return this.staticNotes.indexOf(noteName);
        }

        getKey(){
          return this.modularScale[0];
        }

        getMode(){
          //todo is this the right mode position??
          //safer approach would be to match the current setup in this.modularScale and find the one in the this.staticScales that matches
          return this.staticScales[this.modePosition][1];
        }

        turnModusRight() {
          this.modePosition = (this.modePosition + 4) % 7;
          this.modularScale[this.modePosition] += 1;
        }

        turnModusLeft() {
          this.modularScale[this.modePosition] -= 1;
          this.modePosition = (this.modePosition + 3) % 7;
        }

        turnKeyRight() {
          for(let i = 0;i <this.modularScale.length; i++)
            this.modularScale[i]+= 7;
          if (this.modularScale[0]>11)
            this.octaveDown();
        }

        turnKeyLeft() {
          for(let i = 0;i <this.modularScale.length; i++)
            this.modularScale[i]-= 7;
          if (this.modularScale[0]<0)
            this.octaveUp();
        }

        octaveUp(){
          for(let i = 0;i <this.modularScale.length; i++)
            this.modularScale[i]+= 12;
        }

        octaveDown(){
          for(let i = 0;i <this.modularScale.length; i++)
            this.modularScale[i]-= 12;
        }
      }
      customElements.define(MusicScale.is, MusicScale);
    </script>
</dom-module>