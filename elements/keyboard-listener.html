<link rel="import" href="keyevents-listener.html">

<dom-module id="keyboard-listener">
  <template>
	<style>
		:host {
			display: none;
		}
	</style>

    <keyevents-listener on-key-down="_keyWasDown" on-key-up="_keyWasUp"></keyevents-listener>

  </template>

  <script>

    class HeldKeysUnit {
      constructor(){
        this.held = [];
        this.action = undefined;
        this.activeKey = undefined;
      }

      addKey(key) {
        let clone = this.clone();
        clone.action = true;
        clone.held.push(key);
        clone.activeKey = key;
        return clone;
      }

      removeKey(key){
        let clone = this.clone();
        clone.action = true;
        clone.activeKey = key;
        let index = clone.held.indexOf(key);
        if (index !== -1)
          clone.held.splice(index,1);
        return clone;
      }

      getTimeBetweenLastKeyUpAndThisKeyDown(){

      }
    }

    class KeyboardListener extends Polymer.Element {
      static get is() {
        return "keyboard-listener";
      }
      static get config() {
        return {
          properties: {
            pressedKeys: {
              type: Array,
              value: function() {
                return []
              }
            },
            pressedTimes: {
              type: Array,
              value: function() {
                return []
              }
            }
          }
        }
      }

      _keyWasDown(e) {
        let key = e.code;
        if (this.pressedKeys.indexOf(key) === -1)
          this.pressedKeys.push(key);
        this._fireEvent("pressed-keys", {pressedKey: key, heldKeys: this.pressedKeys});
      }

      _keyWasUp(e) {
        let key = e.code;
        let index = this.pressedKeys.indexOf(key);
        if (index !== -1)
          this.pressedKeys.splice(index,1);
        this._fireEvent("unpressed-keys", {unpressedKey: key, heldKeys: this.pressedKeys});
      }
      
      _fireEvent(name, keys) {
        this.dispatchEvent(new CustomEvent(name, {"detail": keys, "bubbles": true, "composed": true}));
      }
    }
    customElements.define(KeyboardListener.is, KeyboardListener);
  </script>
</dom-module>