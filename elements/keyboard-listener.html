<link rel="import" href="keyevents-listener.html">

<dom-module id="keyboard-listener">
  <template>
	<style>
		:host {
			display: none;
		}
	</style>

    <keyevents-listener on-key-down="_keyWasDown" on-key-up="_keyWasUp"></keyevents-listener>

  </template>

  <script>
    class KeyboardListener extends Polymer.Element {
      static get is() {
        return "keyboard-listener";
      }
      static get config() {
        return {
          properties: {
            pressedKeys: {
              type: Array,
              value: function() {
                return []
              }
            }
          }
        }
      }

      _keyWasDown(e) {
        var key = e.code;

        if (this.pressedKeys.indexOf(key) === -1) {
          this.pressedKeys.push(key);
        }

        this._fireEvent("pressed-keys", {pressedKey: key, heldKeys: this.pressedKeys});
      }

      _keyWasUp(e) {
        var key = e.code;

        var index = this.pressedKeys.indexOf(key);
        if (index !== -1)
          this.pressedKeys.splice(index,1);
        
        this._fireEvent("pressed-keys", {unpressedKey: key, heldKeys: this.pressedKeys});
      }
      
      _fireEvent(name, keys) {
        var _event = new CustomEvent(name, {"detail": keys, "bubbles": true, "composed": true});
        this.dispatchEvent(_event);
      }
    }
    customElements.define(KeyboardListener.is, KeyboardListener);
  </script>
</dom-module>