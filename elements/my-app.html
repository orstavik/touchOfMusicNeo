<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="running-text.html">
<link rel="import" href="keyboard-container.html">
<link rel="import" href="tempo-timer.html">
<link rel="import" href="joievent-player.html">
<link rel="import" href="game-judge.html">
<link rel="import" href="joievent-canon.html">

<dom-module id="my-app">
  <template>
    <style>
      :host {
        display: block;
        height: 100vh;
        background-image: url("../images/background/2016-11-01.png");
        background-size: auto 100%;
        background-repeat: no-repeat;
        background-position: bottom;
      }
    </style>

    <joievent-player input="[[scenario]]" id="joiplayer">

      <game-judge id="judge">
        <!--<running-text id="runner" pressed="[[pressedArray]]" text="[[futures]]" tempo="[[tempo]]"></running-text>-->

        <keyboard-container id="keyboard" on-pressed-keys="_pressedAction" futures="[[futures]]">
          <joievent-canon></joievent-canon>
        </keyboard-container>

        <tempo-timer on-tick="_makeScenario" tempo="[[tempo]]" id="timer"></tempo-timer>
      </game-judge>

    </joievent-player>

  </template>

  <script>
    class MyApp extends Polymer.Element {
      static get is() {
        return "my-app";
      }
      static get config() {
        return {
          properties: {
            pressedArray: {
              type: Array,
              value: function() {
                return []
              }
            },
            scenario: {
              type: String,
              value: 
                    "A@letter:A,duration:1 K@letter:K,duration:2 A! A! A! K! K! K! A! A! A!",
                    // "O K U O K,10 J L K J L K Y I U Y I U T I U T I U",
              reflectToAttribute: true,
              // observer: "_scenarioReset"
            },
            futures: {
              type: String,
              value: ""
            },
            tempo: {
              type: Number,
              value: 100
            }
          }
        }
      }

      _pressedAction(e) {
        this.pressedArray = e.detail.pressed;
      }

      _scenarioReset() {
        this.futures = "";
        this.$.timer.time = 0;
        this.$.runner.resetRotation();
      }

      _makeScenario(e) {
        var i = e.detail.time;
        var alphabet = "1234567890-=ABCDEFGHIJKLMNOPQRSTUVWXYZ[];',./";
        // if (i < this.scenario.length && i >= 0) {
        //   this.futures += this.scenario[i];
        //   this.$.keyboard.readFutures(i-7);
        // } else if (i < this.scenario.length+3+7) {
        //   this.$.keyboard.readFutures(i-7);
        // }
        if (i >= 0) {
          this.futures += alphabet[Math.floor(Math.random()*alphabet.length)];
          this.$.keyboard.readFutures(i-7);
        } else {
          this.$.keyboard.readFutures(i-7);
        }
      }
    }
    customElements.define(MyApp.is, MyApp);
  </script>
</dom-module>