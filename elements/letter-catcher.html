<link rel="import" href="single-letter.html">

<dom-module id="letter-catcher">
  <template>
    <style>
      :host {
        display: block;
      }
      #letterWrapper {
        display: block;
        position: absolute;
        top: 15.5vh;
        left: 50vw;
        transform: translate(-51%, -50%);
        width: 80vh;
        height: 12.5vh;
        overflow: hidden;
      }
      #letter {
        display: flex;
        flex-wrap: wrap;
        width: 100%;
        position: absolute;
        transition-duration: 0.3s;
      }
    </style>

    <div id="letterWrapper">
      <div id="letter">
        <template is="dom-repeat" items="[[scenario]]">
          <single-letter info="[[item]]" tempo="[[tempo]]" waiting></single-letter>
        </template>
      </div>
    </div>

    <slot on-joievent="_readEvent"></slot>

  </template>

  <script>
    class LetterCatcher extends Polymer.Element {
      static get is() {
        return "letter-catcher";
      }

      static get config() {
        return {
          properties: {
            scenario: {
              type: Array
            },
            timeStamp: {
              type: Number,
              value: 0
            },
            tempo: Number
          }
        }
      }

      _readEvent(e) {
        if (e.timeStamp - this.timeStamp < 50)
          return;
        let letter = this.$.letter.querySelector("[letter^="+e.detail.letter+"][waiting]");
        let wRect = this.$.letterWrapper.getBoundingClientRect();
        let lRect = letter.getBoundingClientRect();
        let diff = wRect.height/2-letter.offsetTop;
        if (diff < 0) {
          letter.parentNode.style.transform = "translateY("+(diff-lRect.height/2)+"px)";
        }
        letter.removeAttribute("waiting");
        let current = this.$.letter.querySelector("[current]");
        if (current)
          current.current = false;
        letter.current = true;
        this.timeStamp = e.timeStamp;
      }

      _slideUp(letter) {
        let wRect = this.$.letterWrapper.getBoundingClientRect();
        let lRect = letter.getBoundingClientRect();
        let diff = wRect.height/2-letter.offsetTop;
        if (diff < 0) {
          letter.parentNode.style.transform = "translateY("+(diff-lRect.height/2)+"px)";
        }
      }
    }
    customElements.define(LetterCatcher.is, LetterCatcher);
  </script>
</dom-module>