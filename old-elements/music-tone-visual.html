<dom-module id="music-tone-visual">
  <template>
    <style>
      :host {
        display: flex;
        align-items: center;
        justify-content: center;
        position: absolute;
        width: 16vh;
        height: 16vh;
        border-bottom-left-radius: 50%;
        border-bottom-right-radius: 50%;
        border-top-right-radius: 50%;
        transform-origin: left top;
        transition-duration: 0.5s;
        box-shadow: 0 0 5px 0 black;
      }

      /*.colorClock0 { background-image: url(../images/flower/1126.png); background-size: cover; }*/
      :host(.colorClock0) { background-color: hsla(0, 100%, 50%, 0.75); }
      :host(.colorClock1) { background-color: hsla(30, 100%, 50%, 0.75); }
      :host(.colorClock2) { background-color: hsla(60, 100%, 50%, 0.75); }
      :host(.colorClock3) { background-color: hsla(90, 100%, 50%, 0.75); }
      :host(.colorClock4) { background-color: hsla(120, 100%, 50%, 0.75); }
      :host(.colorClock5) { background-color: hsla(150, 100%, 50%, 0.75); }
      :host(.colorClock6) { background-color: hsla(180, 100%, 50%, 0.75); }
      :host(.colorClock7) { background-color: hsla(210, 100%, 50%, 0.75); }
      :host(.colorClock8) { background-color: hsla(240, 100%, 50%, 0.75); }
      :host(.colorClock9) { background-color: hsla(270, 100%, 50%, 0.75); }
      :host(.colorClock10) { background-color: hsla(300, 100%, 50%, 0.75); }
      :host(.colorClock11) { background-color: hsla(330, 100%, 50%, 0.75); }

      img{
        height: 100%;
        width: 100%;
        display: inline-block;
        transform: rotate(0deg);
        transition: transform 0.5s cubic-bezier(0.39, 0.08, 0.53, 1.02);
        transform-origin: 0% 0;
        margin-left: -7%;
        margin-top: 18%;
      }
      #toneText {
        color: black;
        font-size: 4vh;
        transform: rotate(-45deg);
      }

    </style>

    <!--<img class$="seven[[toneSeven]] [[_getColorClass(tone)]]" alt="[[tone]]" /> src="[[_getImage(tone)]]"-->
    <div id="toneText" class$="seven[[toneSeven]]">[[tone]]</div>

  </template>
  <script>

    class MusicToneVisual extends Polymer.Element {
      static get is() {
        return "music-tone-visual";
      }

      static get config() {
        return {
          properties: {
            tone: String,
            toneSeven: Number,
            key: String,
          },
          observers: ["_setStyle(tone,toneSeven,key)"]
        }
      }

      constructor() {
        super();
        super.ready();
      }

      connectedCallback() {
        this._setStyle(this.tone, this.toneSeven, this.key);
      }

      _setStyle(tone, toneSeven, key) {
        this.classList.add(this._getColorClass(tone));
        this.style.transform = "rotate("+(45+this._getRotation())+"deg) translate(1.6vh, 1.6vh) scale("+this._getScale()+")";
      }

      _getRotation() {
        let n = (MusicToneVisual.makeToneRotation(this.tone)+6)%12;
        return n*30;
      }

      _getScale() {
        if (this.toneSeven == 0 || this.toneSeven == 3 || this.toneSeven == 4) return 1;
        else if (this.toneSeven == 1 || this.toneSeven == 2 || this.toneSeven == 5) return 0.6;
        else if (this.toneSeven == 6) return 0.4;
        else if (this.toneSeven == -1) return 0;
      }

      // _getImage(tone){
      //   let col = MusicToneVisual.makeColorDegree(tone)+1;
      //   return "../images/flower3/"+col+"p.png";
      // }

      _getColorClass(tone){
        return "colorClock" + MusicToneVisual.makeColorDegree(tone);
      }

      static makeColorDegree(tone){
        return MusicScale.getWheelOf5Number(tone);
      }

      static makeToneRotation(tone){
        return MusicScale.twelveNotes.indexOf(tone);
      }

      static makeKeyRotation(key){
        return MusicScale.twelveNotes.indexOf(key);
      }

      static makeRelativeRotation(tone, key){
        return (MusicToneVisual.makeToneRotation(tone) + MusicToneVisual.makeKeyRotation(key)) %12;
      }
    }
    customElements.define(MusicToneVisual.is, MusicToneVisual);
  </script>
</dom-module>